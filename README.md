# üìã Sistema de Invent√°rio Tiago v2.0

Sistema completo para gerenciamento de invent√°rios com banco de dados PostgreSQL, autentica√ß√£o, controle de acesso e auditoria. Desenvolvido em Next.js 15 com NextAuth para autentica√ß√£o segura via Google OAuth e Prisma ORM para persist√™ncia de dados.

---

## Demonstra√ß√£o Visual

| Relat√≥rio geral|
|:---:|
| ![Tela 13](./public/Telas/13.jpg) |

<details>
<summary>üì∏ <strong>Ver Screenshots do Sistema</strong></summary>

| Tela inicial | Invent√°rios dispon√≠veis| Cria√ß√£o de invent√°rios|
|:---:|:---:|:---:|
| ![Tela 01](./public/Telas/01.jpg) | ![Tela 02](./public/Telas/02.jpg) | ![Tela 03](./public/Telas/03.jpg) |

| Realizar invent√°rio | Nome do invent√°rio | Cadastro da equipe |
|:---:|:---:|:---:|
| ![Tela 04](./public/Telas/04.jpg) | ![Tela 05](./public/Telas/05.jpg) | ![Tela 06](./public/Telas/06.jpg) |

<details>
<summary>üîç <strong>Ver Mais Screenshots</strong></summary>

| Gerenciar permiss√µes | Realizar invent√°rio | Item inventariado |
|:---:|:---:|:---:|
| ![Tela 07](./public/Telas/07.jpg) | ![Tela 08](./public/Telas/08.jpg) | ![Tela 09](./public/Telas/09.jpg) |

| Item n√£o encontrado| Cadastro de item | Cadastro de item 2 |
|:---:|:---:|:---:|
| ![Tela 10](./public/Telas/10.jpg) | ![Tela 11](./public/Telas/11.jpg) | ![Tela 12](./public/Telas/12.jpg) |

| Relat√≥rio geral|
|:---:|
| ![Tela 13](./public/Telas/13.jpg) |

</details>
</details>

---

## üß™ Teste o Sistema

**Quer experimentar sem configurar nada?**

1. **üì• [Baixar Arquivo de Exemplo](./public/exemplo-json/inventario.json)** 
2. **üåê Acesse o sistema** e fa√ßa login com Google
3. **üì§ Fa√ßa upload** do arquivo baixado
4. **üéØ Explore todas as funcionalidades!**

---

## üìñ Documenta√ß√£o

- **üë®‚Äçüíª Para Desenvolvedores**: Continue lendo este README
- **üë• Para Usu√°rios Finais**: [üìã Guia do Usu√°rio - Comiss√µes Inventariantes](./README-USUARIOS.md)

---

## ‚ú® Principais Funcionalidades

### **Sistema de Banco de Dados Robusto**

- **PostgreSQL**: Banco de dados relacional para alta performance e confiabilidade
- **Prisma ORM**: Mapeamento objeto-relacional com type safety
- **Migra√ß√µes autom√°ticas**: Versionamento e evolu√ß√£o do schema
- **Relacionamentos**: Estrutura normalizada com integridade referencial

### üîê **Autentica√ß√£o e Seguran√ßa**

- **Login via Google OAuth**: Autentica√ß√£o segura usando NextAuth
- **Controle de sess√µes**: Prote√ß√£o autom√°tica de todas as p√°ginas e APIs
- **Auditoria completa**: Logs detalhados armazenados no banco de dados
- **Prote√ß√£o de dados sens√≠veis**: Conformidade com LGPD

### üë• **Sistema de Permiss√µes Granular**

- **Propriet√°rio √∫nico**: Quem envia o invent√°rio √© o propriet√°rio
- **Compartilhamento controlado**: Propriet√°rio pode conceder acesso via email
- **Cria√ß√£o autom√°tica de usu√°rios**: Sistema cria usu√°rios automaticamente ao conceder acesso
- **Revoga√ß√£o instant√¢nea**: Remo√ß√£o de acessos a qualquer momento
- **Interface visual**: Gerenciamento f√°cil de usu√°rios autorizados

### üìÇ **Processamento de Invent√°rios**

- **Upload inteligente**: Suporte para arquivos .json e .csv
- **Migra√ß√£o autom√°tica**: Convers√£o de dados legados para PostgreSQL
- **Captura autom√°tica**: Nome do respons√°vel obtido da sess√£o autenticada
- **Organiza√ß√£o autom√°tica**: Estrutura relacional otimizada
- **Rastreabilidade**: Informa√ß√µes completas de auditoria no banco

### üìä **Execu√ß√£o de Invent√°rio Avan√ßada**

- **Busca por tombos**: Sistema de pesquisa r√°pida com cache de banco
- **Cadastro din√¢mico**: Adi√ß√£o de novos itens com marca√ß√£o especial
- **Controle de status**: Atualiza√ß√£o do estado de conserva√ß√£o
- **Valida√ß√£o de salas**: Alertas para mudan√ßas de localiza√ß√£o
- **Interface otimizada**: Foco autom√°tico e UX aprimorada
- **Marca√ß√£o especial**: Itens cadastrados durante invent√°rio s√£o identificados

### üìà **Relat√≥rios e Visualiza√ß√£o Aprimorados**

- **Relat√≥rios din√¢micos**: Dados em tempo real do PostgreSQL
- **Organiza√ß√£o por sala**: Visualiza√ß√£o completa incluindo salas vazias
- **Status visual**: Indica√ß√£o clara de itens inventariados vs n√£o inventariados
- **Marca√ß√£o especial**: Badge para itens cadastrados durante invent√°rio
- **Navega√ß√£o integrada**: Links diretos entre relat√≥rio e invent√°rio
- **Dados do inventariante**: Exibi√ß√£o correta do nome real dos usu√°rios

### üß™ **Demonstra√ß√£o e Testes**

- **Arquivo de exemplo**: JSON com dados fict√≠cios realistas para teste
- **Download direto**: Dispon√≠vel na p√°gina inicial para usu√°rios n√£o logados  
- **Screenshots completos**: 13 telas do sistema para visualiza√ß√£o
- **Teste sem instala√ß√£o**: Possibilidade de testar antes de configurar
- **Dados de demonstra√ß√£o**: Estrutura completa para entender o funcionamento

## üèóÔ∏è Arquitetura do Sistema

### **Modelo de Dados PostgreSQL**

Sistema com banco de dados relacional robusto:

```sql
-- Usu√°rios do sistema
usuarios {
  id: String (CUID)
  email: String (unique)
  nome: String
  createdAt: DateTime
  updatedAt: DateTime
}

-- Invent√°rios
inventarios {
  id: String (CUID)
  nome: String (unique)
  nomeExibicao: String
  proprietarioId: String -> usuarios.id
  createdAt: DateTime
  updatedAt: DateTime
}

-- Itens do invent√°rio
itens_inventario {
  id: String (CUID)
  inventarioId: String -> inventarios.id
  numero: String
  [... campos espec√≠ficos do item ...]

  -- Campos de invent√°rio
  dataInventario: DateTime?
  inventarianteId: String? -> usuarios.id
  salaEncontrada: String?
  statusInventario: String?
  cadastradoDuranteInventario: Boolean
}

-- Permiss√µes de acesso
permissoes {
  id: String (CUID)
  inventarioId: String -> inventarios.id
  usuarioId: String -> usuarios.id
  ativa: Boolean
  createdAt: DateTime
}

-- Logs de auditoria
audit_logs {
  id: String (CUID)
  timestamp: DateTime
  acao: String
  usuarioId: String? -> usuarios.id
  inventarioId: String? -> inventarios.id
  detalhes: Json?
  ip: String?
  userAgent: String?
}
```

### **Sistema de Auditoria**

Auditoria completa no banco de dados PostgreSQL:

**Eventos rastreados:**

- `upload_inventory` - Cria√ß√£o de novos invent√°rios
- `view_inventory` - Visualiza√ß√£o de invent√°rios
- `search_item` - Busca por itens espec√≠ficos
- `add_item` - Adi√ß√£o de novos itens
- `update_item` - Atualiza√ß√£o de itens existentes
- `PERMISSAO_CONCEDIDA` - Concess√£o de acessos
- `PERMISSAO_REVOGADA` - Revoga√ß√£o de acessos
- `ACESSO_NEGADO` - Tentativas n√£o autorizadas

## üõ°Ô∏è Seguran√ßa e Controle de Acesso

### **N√≠veis de Prote√ß√£o**

1. **Autentica√ß√£o obrigat√≥ria**: Todas as p√°ginas e APIs protegidas
2. **Verifica√ß√£o de permiss√µes**: Controle granular por invent√°rio
3. **Valida√ß√£o server-side**: Seguran√ßa em todas as opera√ß√µes
4. **Logs de auditoria**: Rastreamento completo de atividades

### **Gerenciamento de Usu√°rios**

- **Propriet√°rio**: Controle total sobre o invent√°rio
- **Usu√°rios autorizados**: Acesso para visualiza√ß√£o e edi√ß√£o
- **Interface de gerenciamento**: Modal para adicionar/remover usu√°rios
- **Valida√ß√£o de emails**: Sistema robusto de verifica√ß√£o

## üöÄ Fluxo de Trabalho

### **1. Cria√ß√£o de Invent√°rio**

1. Usu√°rio faz login via Google
2. Envia arquivo .json ou .csv
3. Sistema processa e cria estrutura de dados
4. Propriet√°rio pode compartilhar acesso com outros usu√°rios

### **2. Execu√ß√£o do Invent√°rio**

1. Acesso √† p√°gina espec√≠fica do invent√°rio
2. Busca por n√∫meros de tombo
3. Confirma√ß√£o ou cadastro de itens
4. Atualiza√ß√£o de status e localiza√ß√£o

### **3. Colabora√ß√£o Segura**

1. Propriet√°rio adiciona colaboradores por email
2. Colaboradores acessam o invent√°rio normalmente
3. Todas as a√ß√µes s√£o auditadas individualmente
4. Propriet√°rio pode revogar acessos quando necess√°rio

### **4. Relat√≥rios e An√°lise**

1. Gera√ß√£o de relat√≥rios organizados por sala
2. Visualiza√ß√£o do progresso do invent√°rio
3. Acesso protegido aos dados sens√≠veis

## ‚öôÔ∏è Configura√ß√£o e Instala√ß√£o

### **Pr√©-requisitos**

- Node.js 18+ instalado
- PostgreSQL 13+ instalado e rodando
- Conta Google para OAuth (Google Cloud Console)

### **1. Clone e Instala√ß√£o**

```bash
git clone https://github.com/tiagogarrais/inventario-tiago.git
cd inventario-tiago
npm install
```

### **2. Configura√ß√£o do Banco de Dados**

1. Instale PostgreSQL em sua m√°quina
2. Crie um banco de dados:
   ```sql
   CREATE DATABASE inventario_tiago;
   ```

### **3. Configura√ß√£o do Google OAuth**

1. Acesse [Google Cloud Console](https://console.cloud.google.com/)
2. Crie um novo projeto ou use existente
3. V√° em "APIs e Servi√ßos" > "Credenciais"
4. Crie "ID do cliente OAuth 2.0"
5. Configure URIs de redirecionamento:
   ```
   http://localhost:3000/api/auth/callback/google
   ```

### **4. Vari√°veis de Ambiente**

Copie `.env.example` para `.env.local` e configure:

```bash
# Database
DATABASE_URL="postgresql://username:password@localhost:5432/inventario_tiago"

# NextAuth
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-nextauth-secret-here

# Google OAuth
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
```

**Para gerar NEXTAUTH_SECRET:**

```bash
openssl rand -base64 32
```

### **5. Configura√ß√£o do Prisma**

```bash
# Executar migra√ß√µes do banco
npx prisma migrate dev

# Gerar cliente Prisma
npx prisma generate
```

### **6. Execu√ß√£o**

**Desenvolvimento local:**

```bash
npm run dev
```

**Acesso na rede local:**

```bash
npm run dev -- -H 0.0.0.0
```

Acesse via `http://[IP-DA-MAQUINA]:3000`

**Produ√ß√£o local:**

```bash
npm run build && npm run start
```

## üîß Tecnologias Utilizadas

- **Frontend**: Next.js 15, React 19, Tailwind CSS
- **Autentica√ß√£o**: NextAuth.js com Google OAuth
- **Backend**: Next.js API Routes
- **Banco de Dados**: PostgreSQL 13+
- **ORM**: Prisma ORM com TypeScript
- **Auditoria**: Logs estruturados no PostgreSQL
- **Processamento**: CSV Parser para arquivos .csv
- **Deploy**: Vercel com PostgreSQL (Neon/Supabase)

## üìÅ Estrutura do Projeto

```
src/app/
‚îú‚îÄ‚îÄ api/                    # APIs do backend
‚îÇ   ‚îú‚îÄ‚îÄ auth/              # Configura√ß√£o NextAuth
‚îÇ   ‚îú‚îÄ‚îÄ upload/            # Upload de invent√°rios
‚îÇ   ‚îú‚îÄ‚îÄ permissoes/        # Gerenciamento de acessos
‚îÇ   ‚îú‚îÄ‚îÄ verificar-acesso/  # Verifica√ß√£o de permiss√µes
‚îÇ   ‚îú‚îÄ‚îÄ listar/            # Listagem de invent√°rios
‚îÇ   ‚îú‚îÄ‚îÄ add-inventario/    # Adi√ß√£o de itens
‚îÇ   ‚îú‚îÄ‚îÄ update-inventario/ # Atualiza√ß√£o de itens
‚îÇ   ‚îú‚îÄ‚îÄ cabecalhos/        # API de cabe√ßalhos
‚îÇ   ‚îî‚îÄ‚îÄ salas/             # API de salas
‚îú‚îÄ‚îÄ components/            # Componentes React
‚îÇ   ‚îú‚îÄ‚îÄ Cabecalho.js      # Header com auth
‚îÇ   ‚îú‚îÄ‚îÄ Criar.js          # Upload de arquivos
‚îÇ   ‚îú‚îÄ‚îÄ Listar.js         # Lista de invent√°rios
‚îÇ   ‚îú‚îÄ‚îÄ Cadastrar.js      # Cadastro de itens
‚îÇ   ‚îî‚îÄ‚îÄ GerenciadorPermissoes.js # Gerenciar usu√°rios
‚îú‚îÄ‚îÄ inventario/[nome]/     # P√°ginas din√¢micas de invent√°rio
‚îú‚îÄ‚îÄ relatorio/[nome]/      # P√°ginas de relat√≥rios
‚îú‚îÄ‚îÄ cadastrar/             # P√°gina de cadastro
‚îú‚îÄ‚îÄ debug/                 # P√°gina de debug
‚îú‚îÄ‚îÄ lib/                   # Utilit√°rios e servi√ßos
‚îÇ   ‚îú‚îÄ‚îÄ db.js             # Configura√ß√£o Prisma
‚îÇ   ‚îî‚îÄ‚îÄ services.js       # Services para banco de dados
‚îú‚îÄ‚îÄ prisma/               # Schema e migra√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma     # Modelo de dados
‚îÇ   ‚îî‚îÄ‚îÄ migrations/       # Migra√ß√µes do banco
‚îú‚îÄ‚îÄ public/               # Arquivos p√∫blicos
‚îÇ   ‚îú‚îÄ‚îÄ Telas/           # Screenshots do sistema (01.jpg - 13.jpg)
‚îÇ   ‚îî‚îÄ‚îÄ exemplo-json/    # Arquivo de exemplo para download
‚îÇ       ‚îî‚îÄ‚îÄ inventario.json # Dados fict√≠cios para teste
‚îî‚îÄ‚îÄ layout.js             # Layout principal
```

## üöÄ Deploy e Produ√ß√£o

### **Deploy no Vercel**

Sistema totalmente compat√≠vel com Vercel usando PostgreSQL:

1. **Configure o banco PostgreSQL** (Neon, Supabase, ou outro)
2. **Configure as vari√°veis de ambiente** no Vercel
3. **Deploy autom√°tico** via Git

```bash
# Build otimizado
npm run build

# Produ√ß√£o local
npm run start

# Com acesso na rede
npm run start -- -H 0.0.0.0
```

### **Vari√°veis de Ambiente para Produ√ß√£o**

```bash
# Database (exemplo Neon)
DATABASE_URL="postgresql://username:password@host.neon.tech/database?sslmode=require"

# NextAuth
NEXTAUTH_URL=https://seu-dominio.vercel.app
NEXTAUTH_SECRET=your-production-secret

# Google OAuth
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
```

### **Comandos √öteis**

```bash
# Visualizar banco de dados
npx prisma studio

# Reset do banco (cuidado em produ√ß√£o!)
npx prisma migrate reset

# Deploy de nova migra√ß√£o
npx prisma migrate deploy
```

## üéâ Novidades da Vers√£o 2.0.0

### **üóÑÔ∏è Migra√ß√£o para PostgreSQL**

- Substitui√ß√£o completa do sistema de arquivos JSON por banco PostgreSQL
- Performance drasticamente melhorada
- Integridade referencial e consist√™ncia de dados
- Compatibilidade total com Vercel e outras plataformas

### **üè∑Ô∏è Marca√ß√£o de Itens Cadastrados**

- Itens cadastrados durante invent√°rio recebem marca√ß√£o especial
- Badge visual nos relat√≥rios para identifica√ß√£o
- Campo `cadastradoDuranteInventario` no banco para relat√≥rios futuros

### **üîó Navega√ß√£o Aprimorada**

- Nome do invent√°rio no relat√≥rio √© clic√°vel (link para invent√°rio)
- Navega√ß√£o fluida entre p√°ginas
- UX melhorada com pr√©-preenchimento autom√°tico

### **üë§ Corre√ß√µes de UX**

- Exibi√ß√£o correta do nome real dos inventariantes
- Corre√ß√£o de datas nas permiss√µes
- Bot√£o de revogar acesso funcionando corretamente
- Cria√ß√£o autom√°tica de usu√°rios ao conceder permiss√µes

### **üìä Relat√≥rios Melhorados**

- Salas vazias aparecem nos relat√≥rios
- Identifica√ß√£o visual de itens cadastrados vs encontrados
- Dados em tempo real do banco de dados

## üë®‚Äçüíª Autor

**Tiago das Gra√ßas Arrais**

- GitHub: [@tiagogarrais](https://github.com/tiagogarrais)

---

## üìà Changelog

### **v2.0.0** - 28/09/2025

- üóÑÔ∏è **BREAKING**: Migra√ß√£o completa para PostgreSQL com Prisma ORM
- üè∑Ô∏è **NEW**: Marca√ß√£o especial para itens cadastrados durante invent√°rio
- üîó **NEW**: Links naveg√°veis entre relat√≥rio e invent√°rio
- üë§ **FIX**: Corre√ß√£o na exibi√ß√£o de nomes de inventariantes
- üìä **FIX**: Relat√≥rios agora mostram salas vazias
- üîß **FIX**: Corre√ß√µes em permiss√µes e UX geral
- üöÄ **NEW**: Deploy total no Vercel com banco PostgreSQL
- üì∏ **NEW**: 13 screenshots do sistema dispon√≠veis no reposit√≥rio
- üß™ **NEW**: Arquivo de exemplo para download e teste
- üìÅ **NEW**: Pasta public/ liberada para versionamento completo
- üìñ **NEW**: Guia completo para usu√°rios finais (comiss√µes inventariantes)
- üé® **NEW**: P√°gina inicial redesenhada com se√ß√£o de teste

### **v1.0.0** - Vers√£o inicial

- Sistema baseado em arquivos JSON
- Autentica√ß√£o Google OAuth
- Controle de permiss√µes b√°sico

---

**üéØ Sistema de Invent√°rio v2.0.0 - Robusto, Escal√°vel e Pronto para Produ√ß√£o!**
